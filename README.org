** FEST
FEST - Ruby-адаптер, использующий [[https://wiki.archlinux.org/index.php/Festival_%28%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9%29][Festival]], для озвучки текста и скриптов...
** Установка
- *nix* or OS X ...
- [[https://wiki.archlinux.org/index.php/Festival_%28%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9%29][Festival]] и нужные языки...
- [[https://wiki.archlinux.org/index.php/PulseAudio_%28%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9%29][Pulseaudio]]
- xbacklight ([[https://wiki.archlinux.org/index.php/Backlight_%28%D0%A0%D1%83%D1%81%D1%81%D0%BA%D0%B8%D0%B9%29][backlight]])
#+begin_src ruby
# Gemfile
gem 'fest'
#+end_src
или
#+begin_src ruby
$ gem install fest
#+end_src
** Использование
***** Вызов методов
#+begin_src ruby
# Подключаем
require 'fest'

@fest = Fest.new
text = "Пример"
@fest.say(text)
# => Произнесёт "Пример"

# Расширенный вариант
params = {:language => "cmu_us_slt_arctic_hts"}
text = "This is an example"
@fest.say(text, params)
# => Произнесёт "This is an example" ...

# Все параметры
# params || default value
params[:path] || "/tmp"
params[:down_volume] || [20,60,4] # [min, max, step]
params[:backlight] || nil # отменить проверку подсветки
params[:language] || "voice_msu_ru_nsh_clunits"

# Склонение
text = @fest.pluraform(2, %w(Сообщение Сообщения Сообщений))
puts text
# => "Сообщения"
#+end_src

** Кастомизация
#+begin_src ruby
@fest.init(params)
# Узнает текущую громкость...
# @path, @index, @min_volume, @max_volume ...

@fest.check_optimal_volume
# @volume = @current_volume - @down_volume
# Вычитает из текущей громкости @down_volume

@fest.optimize_min_and_max_volume(min_volume, max_volume)
# Проверяет громкость и ставит min или max ...

@fest.check_conditions
# Проверяет условия
# check_light и check_home_theater

@fest.check_light # (with xbacklight)
# Проверяет яркость не равна ли нулю... если равна выходит...

@fest.check_home_theater
# Проверяет наличие запущенного vlc или xbmc ...
# Выходит если запущено...

@fest.check_say_wav
# Проверяем на max @index ... если нету @index = 1 ...
# Требуется чтобы сообщения не затирались до проигрывания...

@fest.make_wav(text)
# Создаём wav с определённым языком ... с учётом @index...

@fest.change_volume(volume)
# Ставит громкость ...

@fest.expect_if_aplay_now
# Ожидает, если проигрывается сообщение ...

@fest.turn_down_volume
# Получает список входящих каналов @inputs
# Понижает громкость на @down_volume ...
# @down_volume = @current_volume / 10 * 4
# @down_volume = @current_volume / 10 * @params[:down_volume[2]]

@fest.play_wav
# ставит @optimize_volume
# выполняет turn_down_volume
# Проигрывает wav ...

@fest.return_current_volume
# Возращает громкость на каналах @inputs ...
# Возращает громкость до проигрывания ...

@fest.delete_wav
# Удаляет проигранный файл ...
#+end_src
** Решение проблем
***** Уровень громкости не сбрасывает после выхода
****** vlc
#+begin_src bash
#!/bin/bash

vlc.run --play-and-exit $*
amixer set Master 30% > /dev/null 2>&1
#+end_src
